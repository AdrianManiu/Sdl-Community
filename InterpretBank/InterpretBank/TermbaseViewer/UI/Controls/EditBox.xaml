<UserControl x:Class="InterpretBank.TermbaseViewer.UI.Controls.EditBox"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:converters="clr-namespace:InterpretBank.TermbaseViewer.UI.Converters"
             xmlns:platformConverters="clr-namespace:Sdl.Desktop.Platform.Controls.Converters;assembly=Sdl.Desktop.Platform.Controls"
             mc:Ignorable="d"
             x:Name="EditBoxControl"
             HorizontalAlignment="Left"
             d:DesignHeight="450"
             d:DesignWidth="800">

    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/InterpretBank;component/TermbaseViewer/UI/Resources/EditButtonTemplate.xaml" />
            </ResourceDictionary.MergedDictionaries>
            <converters:BoolToColorConverter x:Key="BoolToColorConverter" />
            <platformConverters:InverseBooleanToVisibilityConverter x:Key="InvertBoolToVisConverter" />
            <!--<BooleanToVisibilityConverter x:Key="BoolToVisConverter" />-->
            <Style TargetType="Button">
                <Setter Property="Template"
                        Value="{StaticResource EditButtonTemplate}" />
            </Style>

            <converters:OrBoolToVisibilityConverter  x:Key="MultipleBoolToVisConverter" />
            <Style x:Key="DialogButtonsStyle" TargetType="Button">
                <Setter Property="Template"
                        Value="{StaticResource EditButtonTemplate}" />
                <Setter Property="Background" Value="{Binding ElementName=EditBoxControl, Path=IsEditing, Converter={StaticResource BoolToColorConverter}, ConverterParameter=LightGray}"/>
                <Setter Property="BorderBrush" Value="{Binding ElementName=EditBoxControl, Path=IsEditing, Converter={StaticResource BoolToColorConverter}, ConverterParameter=LightGray}"/>
                <!--<Setter Property="Visibility" Value="{Binding ElementName=EditBoxControl, Path=IsEditing, Converter={StaticResource BoolToVisConverter}}"/>-->
                <Setter Property="Visibility">
                    <Setter.Value>
                        <MultiBinding Converter="{StaticResource MultipleBoolToVisConverter}">
                            <Binding Path="IsEditing" ElementName="EditBoxControl" />
                            <Binding Path="IsFocused" RelativeSource="{RelativeSource Self}"/>
                        </MultiBinding>
                    </Setter.Value>
                </Setter>
            </Style>
        </ResourceDictionary>
    </UserControl.Resources>
    <Border BorderThickness="1">

        <Border.Style>
            <Style TargetType="{x:Type Border}">
                <Style.Triggers>
                    <DataTrigger Binding="{Binding IsMouseOver, ElementName=EditBoxControl}"
                                 Value="True">
                        <Setter Property="BorderBrush"
                                Value="LightGray" />
                        <Setter Property="Background"
                                Value="LightGray" />
                    </DataTrigger>
                </Style.Triggers>
            </Style>
        </Border.Style>

        <Grid x:Name="EditBoxGrid"
              KeyboardNavigation.TabNavigation="Once">
            <Grid.InputBindings>
                <KeyBinding Key="Enter"
                            Modifiers="Alt"
                            CommandParameter="ConfirmEdit"
                            Command="{Binding KeyboardKeypressCommand, ElementName=EditBoxControl}" />
            </Grid.InputBindings>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="2*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <TextBlock Text="{Binding Label, ElementName=EditBoxControl}"
                       Foreground="Gray" />

            <TextBox x:Name="TextBox"
                     Grid.Column="1"
                     BorderThickness="1"
                     GotFocus="TextBox_OnGotFocus"
                     BorderBrush="{Binding IsEditing, ElementName=EditBoxControl, Converter={StaticResource BoolToColorConverter}}"
                     MinWidth="40"
                     TextWrapping="Wrap"
                     AcceptsReturn="True"
                     VerticalScrollBarVisibility="Auto"
                     Text="{Binding EditBoxText, ElementName=EditBoxControl}" />

            <StackPanel Grid.Column="2"
                        Orientation="Horizontal">

                <Button Width="50"
                        Style="{StaticResource DialogButtonsStyle}"
                        CommandParameter="{Binding ElementName=EditBoxControl, Path=SaveEditCommandParameter}"
                        Click="ConfirmEditButton_Click">

                    <Image Source="/InterpretBank;component/Resources/ConfirmEdit.png"
                           Height="10" />
                </Button>
                <Button Style="{StaticResource DialogButtonsStyle}"
                        Width="50"
                        Click="RejectEditButton_OnClick">
                    <Image Source=" /InterpretBank;component/Resources/RejectEdit.png"
                           Height="10" />
                </Button>
            </StackPanel>

            <Button Background="Transparent"
                    BorderBrush="Transparent"
                    Click="EditButton_Click"
                    Visibility="{Binding IsEditing,ElementName=EditBoxControl, Converter={StaticResource InvertBoolToVisConverter}}"
                    Grid.Column="2">
                <Image Source="/InterpretBank;component/Resources/Edit.png"
                       Height="10" />
            </Button>
        </Grid>
    </Border>
</UserControl>