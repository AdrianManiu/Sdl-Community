<UserControl x:Class="InterpretBank.TermbaseViewer.UI.TermbaseViewer"
			 xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
			 xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
			 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
			 xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
			 xmlns:model="clr-namespace:InterpretBank.TermbaseViewer.Model"
			 xmlns:controls="clr-namespace:InterpretBank.TermbaseViewer.UI.Controls"
			 xmlns:converters="clr-namespace:InterpretBank.TermbaseViewer.UI.Converters"
			 xmlns:viewModel="clr-namespace:InterpretBank.TermbaseViewer.ViewModel"
			 mc:Ignorable="d"
			 d:DataContext="{d:DesignInstance viewModel:TermbaseViewerViewModel}"
			 d:DesignHeight="450"
			 d:DesignWidth="800"
			 Name="TermbaseViewer_UserControl">
	<UserControl.InputBindings>
		<KeyBinding Key="E"
					Modifiers="Alt+Shift"
					CommandParameter="True"
					Command="{Binding SetEditingFromKeyboardCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" />
		<KeyBinding Key="Enter"
					CommandParameter="False"
					Command="{Binding SetEditingFromKeyboardCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" />
		<KeyBinding Key="Escape"
					CommandParameter="Revert"
					Command="{Binding SetEditingFromKeyboardCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" />
	</UserControl.InputBindings>
	<UserControl.Resources>
		<ResourceDictionary>
			<ResourceDictionary.MergedDictionaries>
				<ResourceDictionary Source="/Sdl.Desktop.Platform.Styles;component/buttonresources.xaml" />
				<ResourceDictionary Source="../../Styles/ButtonStyles.xaml" />
			</ResourceDictionary.MergedDictionaries>

			<converters:ImageToBitmapImageConverter x:Key="ImageConverter" />
			<converters:WidthToThirdConverter x:Key="WidthToThirdConverter" />
			<BooleanToVisibilityConverter x:Key="BoolToVis" />
			<converters:InvertVisibilityConverter x:Key="InvertVisibilityConverter" />

			<Style TargetType="controls:EditableTextBlock">
				<Setter Property="IsEditing"
						Value="{Binding SelectedItem.IsEditing, Mode=TwoWay}" />
				<Setter Property="MaxWidth"
						Value="{Binding ActualWidth, ElementName=TermbaseViewer_UserControl, Converter={StaticResource WidthToThirdConverter}}" />
				<Style.Triggers>
					<DataTrigger Binding="{Binding SelectedItem.IsRemoved}"
								 Value="True">
						<Setter Property="Foreground"
								Value="Gray" />
					</DataTrigger>
				</Style.Triggers>
			</Style>

			<Style TargetType="controls:EditableTextBlock"
				   x:Key="CommentAll_EditableTextBlockStyle">
				<Setter Property="IsEditing"
						Value="{Binding SelectedItem.IsEditing}" />
			
				<Style.Triggers>
					<DataTrigger Binding="{Binding SelectedItem.IsRemoved}"
								 Value="True">
						<Setter Property="Foreground"
								Value="Gray" />
					</DataTrigger>
				</Style.Triggers>
			</Style>
		</ResourceDictionary>
	</UserControl.Resources>
	<Grid Background="LightGray">
		<Grid.ColumnDefinitions>
			<ColumnDefinition Width="*" />
			<ColumnDefinition Width="3*" />
		</Grid.ColumnDefinitions>

		<Grid Grid.Column="0"
			  Name="TermListPart_Grid">
			<ListBox Background="#f5f8fa"
					 Name="Term_ListBox"
					 Grid.Column="0"
					 Margin="0"
					 BorderThickness="0"
					 ItemsSource="{Binding Terms}"
					 SelectedIndex="{Binding SelectedIndex, Mode=TwoWay}">
				<ListBox.ItemTemplate>
					<DataTemplate DataType="{x:Type model:TermModel}">

						<Grid Name="Term_Grid">
							<Grid.ColumnDefinitions>
								<ColumnDefinition Width="Auto" />
								<ColumnDefinition Width="*" />
							</Grid.ColumnDefinitions>

							<TextBlock DockPanel.Dock="Right"
									   Name="TermName_TextBlock"
									   HorizontalAlignment="Left"
									   VerticalAlignment="Center"
									   Grid.Column="1"
									   Text="{Binding TargetTerm}">
								<TextBlock.Style>
									<Style TargetType="TextBlock"
										   BasedOn="{StaticResource {x:Type TextBlock}}">
										<Style.Triggers>
											<DataTrigger Binding="{Binding IsRemoved}"
														 Value="True">
												<Setter Property="TextDecorations"
														Value="Strikethrough" />
											</DataTrigger>
										</Style.Triggers>
									</Style>
								</TextBlock.Style>
							</TextBlock>
							<Button DockPanel.Dock="Left"
									Command="{Binding RemoveTermCommand}"
									Name="RemoveTerm_Button"
									HorizontalAlignment="Left"
									ToolTip="Remove term"
									Grid.Column="0">
								<Button.Style>
									<Style TargetType="Button"
										   BasedOn="{StaticResource GlyphButtonStyle2}">
										<Setter Property="Content"
												Value="❌" />
										<Setter Property="FontSize"
												Value="8" />
										<Style.Triggers>
											<DataTrigger Binding="{Binding IsRemoved}"
														 Value="True">
												<Setter Property="Content"
														Value="↶" />
											</DataTrigger>
										</Style.Triggers>
									</Style>
								</Button.Style>
							</Button>
						</Grid>
					</DataTemplate>
				</ListBox.ItemTemplate>
			</ListBox>

			<Button Grid.Column="0"
					Style="{StaticResource GlyphButtonStyle3}"
					Click="AddNewTermButton_Click"
					VerticalAlignment="Bottom"
					HorizontalAlignment="Right"
					ToolTip="Add new term"
					Margin="2 0 0 0"
					Content="➕" />

			<Button Grid.Column="0"
					Style="{StaticResource GlyphButtonStyle4}"
					Visibility="{Binding AnyEditedTerms, Converter={StaticResource BoolToVis}}"
					Command="{Binding CommitAllToDatabaseCommand}"
					VerticalAlignment="Bottom"
					Click="SaveEdit_Button_OnClick"
					HorizontalAlignment="Left"
					FontSize="13"
					FontWeight="Black"
					ToolTip="Commit all changes to the database"
					Content="🗄️" />
		</Grid>

		<Grid Name="TermPart_Grid"
			  Margin="0"
			  Background="White"
			  Grid.Column="1">

			<Grid.RowDefinitions>
				<RowDefinition Height="Auto" />
				<RowDefinition Height="*" />
				<RowDefinition Height="Auto" />
			</Grid.RowDefinitions>

			<Grid.ColumnDefinitions>
				<ColumnDefinition />
				<ColumnDefinition />
			</Grid.ColumnDefinitions>

			<DockPanel Name="SourceTerm_DockPanel"
					   Grid.Column="0"
					   Grid.Row="0"
					   Margin="2 0 0 0"
					   VerticalAlignment="Top">

				<StackPanel Orientation="Horizontal"
							DockPanel.Dock="Top">
					<Image Source="{Binding SourceLanguageFlag, Converter={StaticResource ImageConverter}}"
						   Width="19"
						   Height="19" />
					<TextBlock Text="{Binding SourceLanguage.DisplayName}"
							   VerticalAlignment="Center"
							   FontWeight="Light"
							   FontSize="17" />
				</StackPanel>

				<controls:EditableTextBlock Margin="5 5 0 0"
											DockPanel.Dock="Top"
											FontSize="15"
											FontWeight="Black"
											x:Name="SourceTerm_EditableTextBlock"
											Text="{Binding SelectedItem.SourceTerm, Mode=TwoWay}" />

				<StackPanel DockPanel.Dock="Bottom"
							Margin="10 5 0 0">
					<controls:EditableTextBlock Text="{Binding SelectedItem.SourceTermComment1, Mode=TwoWay}"
												MaxWidth="{Binding ActualWidth, ElementName=TermbaseViewer_UserControl, Converter={StaticResource WidthToThirdConverter}}"
												x:Name="SourceTermComment1_EditableTextBlock" />
					<controls:EditableTextBlock Text="{Binding SelectedItem.SourceTermComment2, Mode=TwoWay}"
												Margin="0 2 0 0"
												x:Name="SourceTermComment2_EditableTextBlock" />
				</StackPanel>
			</DockPanel>

			<DockPanel Name="TargetTerm_DockPanel"
					   Margin="10 0 0 0"
					   Grid.Column="1"
					   Grid.Row="0"
					   VerticalAlignment="Top">
				<StackPanel Orientation="Horizontal"
							Name="LanguageDisplay_StackPanel"
							DockPanel.Dock="Top">
					<Image Source="{Binding TargetLanguageFlag, Converter={StaticResource ImageConverter}}"
						   Width="19"
						   Height="19" />
					<TextBlock Text="{Binding TargetLanguage.DisplayName}"
							   VerticalAlignment="Center"
							   FontWeight="Light"
							   FontSize="17" />
				</StackPanel>

				<controls:EditableTextBlock DockPanel.Dock="Top"
											x:Name="TargetTerm_EditableTextBlock"
											Margin="5 5 0 0"
											FontSize="15"
											FontWeight="Black"
											Text="{Binding SelectedItem.TargetTerm, Mode=TwoWay}" />

				<StackPanel DockPanel.Dock="Bottom"
							Margin="10 5 0 0">
					<controls:EditableTextBlock Text="{Binding SelectedItem.TargetTermComment1, Mode=TwoWay}"
												x:Name="TargetTermComment1_EditableTextBlock" />
					<controls:EditableTextBlock Text="{Binding SelectedItem.TargetTermComment2, Mode=TwoWay}"
												Margin="0 2 0 0"
												x:Name="TargetTermComment2_EditableTextBlock" />
				</StackPanel>
			</DockPanel>

			<controls:EditableTextBlock x:Name="CommentAll_EditableTextBlock"
										Grid.Row="1"
										Grid.Column="0"
										Grid.ColumnSpan="2"
										VerticalAlignment="Top"
										Margin="7 10 0 0"
										Style="{StaticResource CommentAll_EditableTextBlockStyle}"
										DockPanel.Dock="Top"
										FontSize="15"
										Text="{Binding SelectedItem.CommentAll, Mode=TwoWay}" />

			<DockPanel Grid.Row="2"
					   Name="TermMenu_DockPanel"
					   VerticalAlignment="Bottom"
					   LastChildFill="False"
					   Grid.Column="0"
					   Grid.ColumnSpan="2">

				<Button Name="EditTerm_Button"
						ToolTip="Edit"
						Click="EditButton_Click"
						FontSize="13"
						DockPanel.Dock="Right"
						Margin="2 0 0 0"
						Content="📝">
					<Button.Style>
						<Style TargetType="Button"
							   BasedOn="{StaticResource GlyphButtonStyle}">
							<Setter Property="Visibility"
									Value="{Binding Visibility, ElementName=ConfirmEdit_StackPanel, Converter={StaticResource InvertVisibilityConverter}}" />
							<Style.Triggers>
								<DataTrigger Binding="{Binding SelectedItem.IsRemoved}"
											 Value="True">
									<Setter Property="Visibility"
											Value="Collapsed" />
								</DataTrigger>
							</Style.Triggers>
						</Style>
					</Button.Style>
				</Button>

				<Button Content="↶"
						Name="RevertChanges_Button"
						FontSize="15"
						Command="{Binding RevertCommand}"
						FontWeight="Bold"
						ToolTip="Undo">
					<Button.Style>
						<Style TargetType="Button"
							   BasedOn="{StaticResource GlyphButtonStyle}">
							<Setter Property="Visibility"
									Value="Collapsed" />
							<Style.Triggers>
								<MultiDataTrigger>
									<MultiDataTrigger.Conditions>
										<Condition Binding="{Binding SelectedItem.Edited}"
												   Value="True" />
										<Condition Binding="{Binding SelectedItem.IsEditing}"
												   Value="False" />
									</MultiDataTrigger.Conditions>
									<Setter Property="Visibility"
											Value="Visible" />
								</MultiDataTrigger>
							</Style.Triggers>
						</Style>
					</Button.Style>
				</Button>

				<StackPanel Orientation="Horizontal"
							DockPanel.Dock="Right"
							Name="ConfirmEdit_StackPanel"
							Visibility="{Binding SelectedItem.IsEditing, Converter={StaticResource BoolToVis}}">

					<Button DockPanel.Dock="Right"
							Name="SaveEdits_Button"
							Foreground="LimeGreen"
							ToolTip="Save edit"
							Click="SaveEdit_Button_OnClick"
							Style="{StaticResource GlyphButtonStyle}"
							FontSize="15"
							FontWeight="Bold"
							Content="✓" />

					<Button DockPanel.Dock="Right"
							Foreground="Red"
							ToolTip="Discard changes"
							Command="{Binding RevertCommand}"
							Name="DiscardEdits_Button"
							Click="SaveEdit_Button_OnClick"
							Style="{StaticResource GlyphButtonStyle}"
							FontSize="15"
							FontWeight="Bold"
							Content="X" />
				</StackPanel>
			</DockPanel>
		</Grid>
	</Grid>
</UserControl>